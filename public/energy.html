<!DOCTYPE html>
<!--[if lt IE 7]>      <html class="no-js lt-ie9 lt-ie8 lt-ie7"> <![endif]-->
<!--[if IE 7]>         <html class="no-js lt-ie9 lt-ie8"> <![endif]-->
<!--[if IE 8]>         <html class="no-js lt-ie9"> <![endif]-->
<!--[if gt IE 8]><!--> <html class="no-js" ng-app="EnergyApp"> <!--<![endif]-->
<head>
	<meta charset="utf-8">
	<meta http-equiv="X-UA-Compatible" content="IE=edge,chrome=1">
	<title>ARM Dashboard Energy App</title>
	<meta name="author" content="Steven Hassall and Sizhe Xi ">
	<meta name="description" content="ARM Dashboard Sensor Monitoring Project">
    <meta name="viewport" content="width=device-width, maximum-scale=1, minimum-scale=1, user-scalable=0, initial-scale=1">
    <link rel="stylesheet" href="css/normalize.min.css">
    <!-- Gridset CSS -->
    <!--[if (!IE) | (gt IE 9)]><!--><link rel="stylesheet" href="css/gridset.css"><!--<![endif]-->
    <!--[if IE 9]><link rel="stylesheet" href="./css/gridset-ie-9.css" /><![endif]-->
    <!--[if lte IE 8]><link rel="stylesheet" href="./css/gridset-ie-lte8.css" /><![endif]-->
    <link rel="stylesheet" href="css/mfglabs_iconset.css">
    <link rel="stylesheet" href="css/menu-component.css">
    <link rel="stylesheet" href="css/main.css">

    <script src="js/vendor/socket.io.js"></script>
	<script src="js/vendor/d3.v3.min.js"></script>
    <script src="js/vendor/angular.min.js"></script>
    <script src="js/vendor/angular-touch.min.js"></script>
    <script src="js/vendor/ui-bootstrap.min.js"></script>
    <script src="js/vendor/underscore-min.js"></script>
    <script src="js/vendor/modernizr-2.6.2-respond-1.1.0.min.js"></script>	
</head>
<body>
<!--[if lt IE 7]>
    <p class="chromeframe">You are using an <strong>outdated</strong> browser. Please <a href="http://browsehappy.com/">upgrade your browser</a> or <a href="http://www.google.com/chromeframe/?redirect=true">activate Google Chrome Frame</a> to improve your experience.</p>
<![endif]-->

    <div class="energy">
    <!-- START .meeting-room -->

        <div id="container" class="container" class="clearfix" ng-controller="energyCtrl">
        <!-- START #container -->

            <section class="mp-pusher" id="mp-pusher">

                <!-- mp-menu -->
                    <nav id="mp-menu" class="mp-menu">
                        <div class="mp-level">
                            <button id="triggerMobile" class="mp-close d-hide t-hide"><i class="icon-cancel_circle icon2x"></i></button>
                            <h2><i class="icon-data_science blue"></i> ARM Buildings</h2>
                            <ul>
                                <li><a href="#">ARM 6</a></li>
                            </ul>
                                
                        </div>
                    </nav>
                    <!-- /mp-menu -->

                <div class="scroller">
                <div class="scroller-inner">
                <!-- start .scroller's -->
                
                <div class="wrapper">
                <!-- START .wrapper -->


                    <header id="banner" class="d1-d9 t1-t4 m-all clearfix">
                    <!-- START #banner -->

                        <button id="trigger"><i class="icon-reorder icon2x"></i></button>

                        <h1><span class="blue">ARM 6</span> MONTHLY <span class="pink">SUSTAINABILITY</span></h1>

                    <!-- END #banner -->
                    </header>

                    <article id="main" class="d1-d4 t1-t3 m-all clearfix">
                    <!-- START #main -->

                        <div id="app-brand" class="m-hide" ng-click="room.front = !room.front" ng-class="{'flipped': room.front}">
                            <div class="ch-item" >              
                                <div class="ch-info-wrap">
                                    <div class="ch-info meetings">
                                        <div class="ch-info-front hexagon"></div>
                                        <div class="ch-info-back hexagon">
                                            <a href="http://arm.redninja.co.uk" title="Return to the Home">
                                                <i class="icon-home icon3x" aria-hidden="true"></i>
                                                <h3>Home</h3>
                                            </a>
                                        </div>  
                                    </div>
                                </div>
                            </div>
                        </div>
                    
                    <!-- END #main -->
                    </article>

                    <section id="app-energy" class="app-content clearfix">				
	                <!-- START #app-energy -->

	                	<aside id="app-description" class="d1-d3 t1-t3 m-all">

	                        <img src="img/Energy_Icon_time.png" alt="Time" />
	                        <h2>{{ daysLeft }} Days Remaining</h2>

	                    </aside>

	                	<article class="d4-d9 t4-t7 m-all" role="article">
	                		
	                		<table>
							  <tr>
							    <th><img src="img/Energy_Icon_electricity.png" alt="Electricity" /></th>
							    <td rowspan="2"><button>Update</button></td>
							  </tr>
							  <tr>
							    <th><img src="img/Energy_Icon_trash.png" alt="Trash" /></th>
							  </tr>
							</table>

	                	</article>

	                	<section class="d10-d12 t8 m-all">

	                		<div class="energyDial">

	                		</div>

	                	</section>

					<!-- END #app-energy -->
					</section>

                <!-- END .wrapper -->
                </div>
                

				<footer id="footer" class="clearfix">
				<!-- START #footer -->

				  <div>
				      <small>v0.201 Design &amp; Coded by <a href="http://www.redninja.co.uk" title="Design and Coded by Red Ninja Studios">Red Ninja Studios</a></small>
				  </div>

				  <div>
				      <a href="http://arm.com" class="logo-arm" title="ARM - Architecture for the digital world"><img src="img/ARM-RGB.png" alt="ARM - Architecture for the digital world" class="logo" /></a>
				  </div>

				<!-- END #footer -->
				</footer>

                <!-- end .scroller's -->
                </div>
                </div>
				
				<div id="loading" ng-class="{'loading': loading, 'loadComplete':!loading}" >
				<div class="inner">
						<div class="box">
							<div class="circle"></div>
							<div class="circle1"></div>
						</div>
				</div>				

            </section>

        <!-- END #container -->
        </div>
    <!-- END .meeting-room -->
    </div>

    <script src="js/vendor/jquery-1.10.1.min.js"></script>
    <script src="js/plugins.js"></script>
    <script src="js/vendor/classie.js"></script>
    <script src="js/vendor/mlpushmenu.js"></script>
    <script src="js/vendor/bullet.js"></script>

    <!-- Gridset overlay script - toggles grid overlay on and off - You can remove this if you want. -->
    <script src="./js/gridset-overlay.js"></script> 
       
	<script>
	// This is temp DATA for bullet chart

	var temporaryData = [
		  {"title":"Electricity","subtitle":"%","ranges":[50,100,150],"measures":[0,107],"markers":[107]},
		  {"title":"Waste","subtitle":"%","ranges":[50,100,150],"measures":[0,80],"markers":[80]}
		]

	</script>
	<script>
	// bullet charts script - http://bl.ocks.org/mbostock/4061961
	// js/plugin.js has more js

	var margin = {top: 0, right: 40, bottom: 52, left: 120},
	    width = 570 - margin.left - margin.right,
	    height = 104 - margin.top - margin.bottom;

	var chart = d3.bullet()
	    .width(width)
	    .height(height);


	  var svg = d3.select("td").selectAll("svg")
	    .data(temporaryData) // currently linked to Temp variable above, Xi work your magic
	    .enter().append("svg")
	      .attr("class", "bullet")
	      .attr("width", width + margin.left + margin.right)
	      .attr("height", height + margin.top + margin.bottom)
	    .append("g")
	      .attr("transform", "translate(" + margin.left + "," + margin.top + ")")
	      .call(chart);

	  var title = svg.append("g")
	      .style("text-anchor", "end")
	      .attr("transform", "translate(-6," + height / 2 + ")");

	  title.append("text")
	      .attr("class", "title")
	      .text(function(d) { return d.title; });

	  title.append("text")
	      .attr("class", "subtitle")
	      .attr("dy", "1em")
	      .text(function(d) { return d.subtitle; });

	  d3.selectAll("button").on("click", function() {
	    svg.datum(randomize).call(chart.duration(1000)); // TODO automatic transition
	  });


	function randomize(d) {
	  if (!d.randomizer) d.randomizer = randomizer(d);
	  d.ranges = d.ranges.map(d.randomizer);
	  d.markers = d.markers.map(d.randomizer);
	  d.measures = d.measures.map(d.randomizer);
	  return d;
	}

	function randomizer(d) {
	  var k = d3.max(d.ranges) * .2;
	  return function(d) {
	    return Math.max(0, d + k * (Math.random() - .5));
	  };
	}

	</script>
    <script>
      (function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){
      (i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o),
      m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m)
      })(window,document,'script','//www.google-analytics.com/analytics.js','ga');

      ga('create', 'UA-46398255-2', '54.194.94.166');
      ga('require', 'linkid', 'linkid.js');
      ga('send', 'pageview');

    </script>
	
	
<script>
var energyApp = angular.module('EnergyApp', ['ui.bootstrap','ngTouch']);
	
energyApp.controller('energyCtrl', function ($rootScope,$scope, $http, $interval, $modal) {

	$scope.loading = true;
	$http.get('/buildings/ARM3/0').success(function(data) {
		//$scope.loadRoomData(data);
        $scope.daysLeft = $scope.getDayLeft();		
        console.log('data loaded   ',$scope.daysLeft);		
		$scope.loading = false;			
	}).error(function(data, status, headers, config) {

		$scope.loading = false;
	});
		
  	/****************************  utiliy ***********************************/
	function getNumberOfDays(year, month) {
		var isLeap = ((year % 4) == 0 && ((year % 100) != 0 || (year % 400) == 0));
		return [31, (isLeap ? 29 : 28), 31, 30, 31, 30, 31, 31, 30, 31, 30, 31][month];
	}
	
	$scope.daysLeft = 0;
	
	$scope.getDayLeft = function(){
	    var now = new Date();
		console.log(now.getDate());
	    return getNumberOfDays(now.getFullYear(),now.getMonth()) -  now.getDate();
	}
	
	$scope.$on('mybroadcast', function(service){
		//console.log('on my broadcast', service);
	    touchScroll("bodyID");
	    sizeContent();			
    })

	$scope.styleFont = function(elem) {
		//console.log(elem ,  elem.length,'--------------------------------------------------------------------');
		if(elem.length <= 5)
		return { "font-size": '65px' };
		else if(elem.length < 7)
		return { "font-size": '48px', 'margin-top':'20px' };
		else if(elem.length < 9)
		return { "font-size": '42px', 'margin-top':'28px' };
		else if(elem.length <=12)
		return { "font-size": '34px', 'margin-top':'37px' };			
		else if(elem.length <=17)
		return { "font-size": '25px', 'margin-top':'50px' };			
	}
	
    $scope.dateformat = function(date){
		var date = new Date(date);	
		var hour = date.getHours(), min = date.getMinutes();
		if(hour < 10) hour = '0'+date.getHours();
		if(min < 10) min = '0'+date.getMinutes();
		return  hour+":"+min;		 
	}
	
  	// touch device overflow fix
  	function isTouchDevice() {
  		try{
  			document.createEvent("TouchEvent");
  			return true;
  		}catch(e){
  			return false;
  		}
  	}

  	function touchScroll(id) {
  		if(isTouchDevice()){ //if touch events exist...
  			var el=document.getElementById(id);
  			var scrollStartPos=0;

  			document.getElementById(id).addEventListener("touchstart", function(event) {
  				scrollStartPos=this.scrollTop+event.touches[0].pageY;
  				event.preventDefault();
  			},false);

  			document.getElementById(id).addEventListener("touchmove", function(event) {
  				this.scrollTop=scrollStartPos-event.touches[0].pageY;
  				event.preventDefault();
  			},false);
  		}
  	}
  	
	function sizeContent() {
		// fix height bug on .container as there was an annoying gap below
		var bodyHeight = window.innerHeight;

		var containerHeight = document.getElementById("container").style.height;
        console.log('size content  body:',bodyHeight,'container', containerHeight);	
    
        var loadingHeight = document.getElementById("loading").style.height;
        console.log('size content  body:',bodyHeight,'loading', loadingHeight);   

		if (bodyHeight > 1100) {
		  document.getElementById('container').style.height = bodyHeight+"px";
          document.getElementById('loading').style.height = bodyHeight+"px";
		}
		else {
		 // window.innerHeight = containerHeight;
         //window.innerHeight = loadingHeight;
		}
		//console.log ('sizeContent working');
	}			
});
	
   function sizeContent() {
      var bodyHeight = $('body').height();
      var containerHeight = $("#container").height();
      var loadingHeight = $("#loading").height();
      //console.log('size contenter   ... ',bodyHeight, containerHeight);
      if (bodyHeight > containerHeight) {
        $('#container').css('height', bodyHeight );
      } else if (containerHeight > loadingHeight) {
        $('#loading').css('height', containerHeight );
      }
      else {
        $('body').css('height', containerHeight);
      }
  }

  //Every resize of window
  $(window).resize(sizeContent); 

</script>	
	
</body>
</html>